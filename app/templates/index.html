<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Árbol Binario</title>
</head>
<body>
    <h1>Visualización del Árbol Binario</h1>
    <a href="admin.html">Ir a panel admin</a>
    <img id="arbolImagen" src="../static/arbol_binario.png" alt="Árbol Binario" style="max-width: 100%; height: auto;">
    <button id="updateTree">Actualizar Árbol</button>
    <img id="treeImage" src="/static/arbol_binario.png" alt="Árbol Binario">
    <h2>Menú</h2>
    <form id="menuForm">
        <select name="opcion" id="opcion">
            <option value="1">Modo automático</option>
            <option value="2">Modo manual</option>
            <option value="3">Chatear con el servidor</option>
            <option value="4">Limpiar árbol</option>
            <option value="6">Ver datos del árbol (orden de inserción)</option>
            <option value="7">Ver datos del árbol ordenados</option>
        </select>
        <input type="number" id="numero" placeholder="Ingrese un número (solo para modo manual)" style="display: none;">
        <input type="text" id="mensaje" placeholder="Escriba un mensaje (solo para chat)" style="display: none;">
        <button type="submit">Enviar</button>
    </form>
    <h2>Acceso Administrativo</h2>
    <form id="adminForm">
        <label for="password">Contraseña:</label>
        <input type="password" id="password" name="password" required>
        <button type="submit">Ingresar</button>
    </form>
    <script>
        document.getElementById('menuForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const opcion = document.getElementById('opcion').value;
            const numero = document.getElementById('numero').value;

            if (opcion === '2') {
                const response = await fetch('/insertar', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ valor: parseInt(numero) })
                });
                const data = await response.json();
                alert(data.mensaje);
            } else if (opcion === '4') {
                const response = await fetch('/borrar', { method: 'POST' });
                const data = await response.json();
                alert(data.mensaje);
            }

            // Actualizar la imagen del árbol
            document.getElementById('arbolImagen').src = '../static/arbol_binario.png?' + new Date().getTime();
        });

        document.getElementById('opcion').addEventListener('change', (e) => {
            const numeroInput = document.getElementById('numero');
            const mensajeInput = document.getElementById('mensaje');
            if (e.target.value === '2') {
                numeroInput.style.display = 'block';
                mensajeInput.style.display = 'none';
            } else if (e.target.value === '3') {
                numeroInput.style.display = 'none';
                mensajeInput.style.display = 'block';
            } else {
                numeroInput.style.display = 'none';
                mensajeInput.style.display = 'none';
            }
        });

        document.getElementById('adminForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const password = document.getElementById('password').value;
            const response = await fetch('/admin', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams({ password })
            });
            if (response.redirected) {
                window.location.href = response.url; // Redirigir si la contraseña es correcta
            } else {
                alert("Contraseña incorrecta");
            }
        });

        document.getElementById('updateTree').addEventListener('click', async () => {
            await fetch('/generate-tree-image');
            document.getElementById('treeImage').src = `/static/arbol_binario.png?${new Date().getTime()}`;
        });
    </script>
</body>
</html>
