<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Árbol Binario</title>
</head>
<body>
    <h1>Visualización del Árbol Binario</h1>
    <a href="admin.html">Ir a panel admin</a>
    <img id="arbolImagen" src="../static/arbol_binario.png" alt="Árbol Binario" style="max-width: 100%; height: auto;">
    <h2>Menú</h2>
    <form id="menuForm">
        <select name="opcion" id="opcion">
            <option value="1">Modo automático</option>
            <option value="2">Modo manual</option>
            <option value="6">Ver datos del árbol (orden de inserción)</option>
            <option value="7">Ver datos del árbol ordenados</option>
        </select>
        <input type="number" id="numero" placeholder="Ingrese un número (solo para modo manual)" style="display: none;">
        <button type="submit">Enviar</button>
    </form>
    <h2>Acceso Administrativo</h2>
    <form id="adminForm">
        <label for="password">Contraseña:</label>
        <input type="password" id="password" name="password" required>
        <button type="submit">Ingresar</button>
    </form>
    <script>
        document.getElementById('menuForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const opcion = document.getElementById('opcion').value;
            const numero = document.getElementById('numero').value;

            const payload = { opcion };
            if (opcion === '2') payload.numero = numero;

            const response = await fetch('/menu', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const data = await response.json();
            alert(data.mensaje);

            if (opcion === '1' || opcion === '2') {
                // Actualizar la imagen del árbol
                document.getElementById('arbolImagen').src = '../static/arbol_binario.png?' + new Date().getTime();
            }
        });

        document.getElementById('opcion').addEventListener('change', (e) => {
            const numeroInput = document.getElementById('numero');
            if (e.target.value === '2') {
                numeroInput.style.display = 'block';
            } else {
                numeroInput.style.display = 'none';
            }
        });

        document.getElementById('adminForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const password = document.getElementById('password').value;
            const response = await fetch('/admin', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams({ password })
            });
            if (response.redirected) {
                window.location.href = response.url; // Redirigir si la contraseña es correcta
            } else {
                alert("Contraseña incorrecta");
            }
        });
    </script>
</body>
</html>
